name: GCP Self Hosted Runner Pipeline (With Logs)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: ðŸ“¥ Checkout Repository
        run: |
          echo "=============================="
          echo "$(date) : Checking out repository"
          echo "=============================="
          git --version
          pwd
          ls -la

      - name: ðŸš€ Application Deployment (NGINX)
        run: |
          echo "=============================="
          echo "$(date) : Starting application deployment"
          echo "=============================="

          sudo systemctl status nginx || true
          sudo systemctl restart nginx
          sudo systemctl status nginx

          echo "$(date) : âœ… NGINX restarted successfully"

      - name: ðŸ“Š Verify Application
        run: |
          echo "=============================="
          echo "$(date) : Verifying application response"
          echo "=============================="

          curl -v http://localhost || echo "NGINX not responding"

      - name: ðŸ›‘ Stop Self-Hosted Runner VM
        run: |
          echo "=============================="
          echo "$(date) : Pipeline completed"
          echo "$(date) : Shutting down VM"
          echo "=============================="

          sudo shutdown -h now
